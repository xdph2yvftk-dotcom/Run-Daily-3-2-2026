<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nháº­t kÃ½ cháº¡y bá»™</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:Arial;
  background:linear-gradient(135deg,#4facfe,#00f2fe);
  margin:0;
  padding:15px;
}

.box{
  background:white;
  border-radius:16px;
  padding:18px;
  box-shadow:0 8px 20px rgba(0,0,0,0.15);
  max-width:420px;
  margin:auto;
}

input,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:16px;
  box-sizing:border-box;
}

button{
  background:#4facfe;
  color:white;
  font-weight:bold;
}

.dayBar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:#eee;
  padding:6px 10px;
  border-radius:12px;
  margin-bottom:10px;
}

.dayBar span{font-size:20px;cursor:pointer;}

.monthNav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:10px;
  font-weight:bold;
}

.sectionBox{
  margin-top:12px;
  background:#e6f7ff;
  padding:10px;
  border-radius:10px;
  font-weight:bold;
}

.sectionHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

.sectionContent{display:none;margin-top:6px;}

.progressBox{
  margin-top:6px;
  font-size:14px;
  background:white;
  padding:8px;
  border-radius:8px;
}

.progressBarWrap{
  background:#ddd;
  height:12px;
  border-radius:10px;
  margin-top:6px;
  overflow:hidden;
}

.progressBar{
  height:100%;
  background:linear-gradient(90deg,#00c853,#4caf50);
  width:0%;
  transition:0.4s;
}

.dots{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}

.dayDot{
  display:flex;
  flex-direction:column;
  align-items:center;
  width:28px;
}

.dot{
  width:18px;
  height:18px;
  border-radius:50%;
  background:#ddd;
}

.dayNum{
  font-size:10px;
  margin-top:2px;
  color:#555;
}

.historyBox{
  margin-top:12px;
  background:#e6f7ff;
  padding:10px;
  border-radius:10px;
  font-weight:bold;
}

.historyItem{
  background:#fff;
  padding:8px;
  border-radius:8px;
  margin-top:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.deleteBtn{
  background:#ff4d4d;
  border:none;
  color:white;
  border-radius:50%;
  width:30px;
  height:30px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  line-height:0;
}

.dayDetail{
  margin-top:10px;
  background:white;
  padding:8px;
  border-radius:8px;
}
</style>
</head>

<body>
<div class="box">
<h2>ğŸƒ Nháº­t kÃ½ cháº¡y bá»™</h2>

<div class="dayBar">
<span onclick="changeDay(-1)">â—€</span>
<input type="date" id="runDate" onchange="loadDayData()">
<span onclick="changeDay(1)">â–¶</span>
</div>

<input type="number" id="km" placeholder="Sá»‘ km">
<input type="number" id="minutes" placeholder="Sá»‘ phÃºt cháº¡y">
<button onclick="saveRun()">LÆ°u</button>

<div class="monthNav">
<span onclick="changeMonth(-1)">â—€</span>
<span id="monthTitle"></span>
<span onclick="changeMonth(1)">â–¶</span>
</div>

<div class="sectionBox">
<div class="sectionHeader" onclick="toggleSection('goalContent')">
<span>ğŸ¯ Má»¥c tiÃªu thÃ¡ng</span>
<span id="goalSummary">ChÆ°a Ä‘áº·t</span>
</div>
<div class="sectionContent" id="goalContent">
<input type="number" id="goalInput" placeholder="Nháº­p má»¥c tiÃªu km">
<button onclick="saveGoal()">LÆ°u má»¥c tiÃªu</button>
<div id="goalProgress" class="progressBox"></div>
<div class="progressBarWrap"><div class="progressBar" id="progressBar"></div></div>
</div>
</div>

<div class="sectionBox">
<div class="sectionHeader" onclick="toggleSection('chartContent')">
<span>ğŸ“Š Biá»ƒu Ä‘á»“ thÃ¡ng</span>
<span>áº¤n Ä‘á»ƒ xem</span>
</div>
<div class="sectionContent" id="chartContent">
<canvas id="runChart"></canvas>
</div>
</div>

<div class="sectionBox">
<div class="sectionHeader" onclick="toggleSection('dotsContent')">
<span>ğŸ”¥ Chuá»—i thÃ¡ng</span>
<span>áº¤n Ä‘á»ƒ xem</span>
</div>
<div class="sectionContent" id="dotsContent">
<div class="dots" id="dots"></div>
<div class="dayDetail" id="detailBox">Chá»n má»™t ngÃ y Ä‘á»ƒ xem chi tiáº¿t</div>
</div>
</div>

<button onclick="toggleSection('historyBox')">ğŸ“œ Xem lá»‹ch sá»­ Ä‘Ã£ nháº­p</button>
<div class="historyBox" id="historyBox" style="display:none;"></div>
</div>

<script>
let currentMonth=new Date().getMonth();
let currentYear=new Date().getFullYear();
let chart;

function toggleSection(id){
const el=document.getElementById(id);
el.style.display=el.style.display==="none"?"block":"none";
if(id==="chartContent" && el.style.display==="block") setTimeout(drawChart,200);
}

function getRuns(){return JSON.parse(localStorage.getItem("runs"))||[];}
function getGoals(){return JSON.parse(localStorage.getItem("goals"))||{};}

function changeDay(step){
const d=new Date(runDate.value);
d.setDate(d.getDate()+step);
runDate.value=d.toISOString().split('T')[0];
loadDayData();
}

function loadDayData(){
const run=getRuns().find(r=>r.date===runDate.value);
km.value=run?run.km:"";
minutes.value=run?run.minutes:"";
}

function saveRun(){
const date=runDate.value;
const kmVal=parseFloat(km.value);
const minutesVal=parseInt(minutes.value);
if(!date||!kmVal||!minutesVal){alert("Nháº­p Ä‘á»§ thÃ´ng tin!");return;}
let runs=getRuns();
const i=runs.findIndex(r=>r.date===date);
if(i>=0) runs[i]={date,km:kmVal,minutes:minutesVal}; else runs.push({date,km:kmVal,minutes:minutesVal});
localStorage.setItem("runs",JSON.stringify(runs));
updateUI();
}

function saveGoal(){
const goals=getGoals();
const key=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}`;
goals[key]=parseFloat(goalInput.value);
localStorage.setItem("goals",JSON.stringify(goals));
updateUI();
}

function changeMonth(step){
currentMonth+=step;
if(currentMonth<0){currentMonth=11;currentYear--;}
if(currentMonth>11){currentMonth=0;currentYear++;}
updateUI();
}

function drawChart(){
const runs=getRuns();
const days=new Date(currentYear,currentMonth+1,0).getDate();
let labels=[],data=[];
for(let d=1;d<=days;d++){
const dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
const run=runs.find(r=>r.date===dateStr);
labels.push(d);
data.push(run?run.km:0);
}
if(chart) chart.destroy();
chart=new Chart(runChart,{type:'bar',data:{labels,datasets:[{data,backgroundColor:'#4facfe'}]},options:{plugins:{legend:{display:false}}}});
}

function drawHistory(){
const runs=getRuns().sort((a,b)=>b.date.localeCompare(a.date));
historyBox.innerHTML="";
runs.forEach(r=>{
const item=document.createElement("div");
item.className="historyItem";
item.innerHTML=`<span>ğŸ“… ${r.date} â€” ğŸƒ ${r.km} km â€” â± ${r.minutes} phÃºt</span><button class="deleteBtn">Ã—</button>`;
item.querySelector("button").onclick=()=>{
if(confirm("XÃ³a ngÃ y nÃ y?")){
let all=getRuns().filter(x=>x.date!==r.date);
localStorage.setItem("runs",JSON.stringify(all));
updateUI();
}};
historyBox.appendChild(item);
});
}

function updateUI(){
monthTitle.innerText=`ThÃ¡ng ${currentMonth+1} / ${currentYear}`;
drawChart();
drawHistory();
}

updateUI();
runDate.value=new Date().toISOString().split('T')[0];
loadDayData();
</script>
</body>
</html>
